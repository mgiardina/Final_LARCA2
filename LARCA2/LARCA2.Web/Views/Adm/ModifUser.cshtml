@model Larca2.Models.UserForm

@{
    ViewBag.Title = "Modify Existing User";
}
@section featured {
    <section class="featured">
        <div class="content-wrapper">
            <hgroup class="title">
                <h1>@ViewBag.Title.</h1>
                <h2>@ViewBag.Message</h2>
            </hgroup>
            <p>
                Here you can modify an user from the system.
            </p>
        </div>
    </section>
}
<script type="text/javascript">
    function AgregaPermisoESP() {
        var CBU_valo = $("#CboBU").val();
        var CBU_desc = $("#CboBU option:selected").text();
        var CBU_valId = $("#CboBU option:selected").val();

        var SMO_valo = $("#CboSMO").val();
        var SMO_desc = $("#CboSMO option:selected").text();
        var SMO_valId = $("#CboSMO option:selected").val();

        var OWN_valo = $("#CboOWNER").val();
        var OWN_desc = $("#CboOWNER option:selected").text();
        var OWN_valId = $("#CboOWNER option:selected").val();

        if (CBU_valId == 0) {
            alert("You must select a valid BU");
            return;
        }
        if (SMO_valId == 0) {
            alert("You must select a valid SMO");
            return;
        }
        if (OWN_valId == 0) {
            alert("You must select a valid OWNER");
            return;
        }
        var carga = CBU_valId + "." + SMO_valId + "." + OWN_valId;
        if ($("#HI_PermisosEsp").val() == "")
            $("#HI_PermisosEsp").val(carga);
        else
            $("#HI_PermisosEsp").val($("#HI_PermisosEsp").val() + "/" + carga);

        $('#tablaPermisos tr:last').after('<tr><td style="display: none">' + CBU_valId + '</td><td style="display: none">' + SMO_valId + '</td><td style="display: none">' + OWN_valId + '</td><td>' + CBU_desc + '</td><td>' + SMO_desc + '</td><td>' + OWN_desc + '</td><td><button id="btn_LESSPermiso" onclick="FuncLESSPermiso(this)" value="Quitar" class="btn btn-warning"> Remove</button></td></tr>');
    }

    function FuncLESSPermiso(donde) {
        $(donde).closest('tr').remove();
        $("#HI_PermisosEsp").val("");
        $("#tablaPermisos tr").each(function (index) {
            var p1 = $(this).find("td").eq(0).html();
            var p2 = $(this).find("td").eq(1).html();
            var p3 = $(this).find("td").eq(2).html();
            if (p1 != "") {
                var carga = p1 + "." + p2 + "." + p3;
                if ($("#HI_PermisosEsp").val() == "")
                    $("#HI_PermisosEsp").val(carga);
                else
                    $("#HI_PermisosEsp").val($("#HI_PermisosEsp").val() + "/" + carga);
            }
        });
    }
</script>

<div class="container-fluid">

    @using (Html.BeginForm("ModificarUsuario", "Adm", FormMethod.Post))
    {
    @Html.HiddenFor(m => m.Usuario.IdRenglon)
    <input name="HI_PermisosEsp" id="HI_PermisosEsp" type="hidden" value="@ViewBag.PermisosUser" />
    <div class="row">
        <div class="col-sm-13">
            <fieldset class="form-group">
                <label for="Nombre">First Name</label>
                @Html.TextBoxFor(m => m.Usuario.Nombre, new { @class = "form-control", @placeholder = "First Name ..." })
                <small class="text-muted">@Html.ValidationMessageFor(m => m.Usuario.Nombre)</small>
            </fieldset>
        </div>
    </div>
    <div class="row">
        <div class="col-sm-13">
            <fieldset class="form-group">
                <label for="Nombre">Last Name</label>
                @Html.TextBoxFor(m => m.Usuario.Apellido, new { @class = "form-control", @placeholder = "Last Name ..." })
                <small class="text-muted">@Html.ValidationMessageFor(m => m.Usuario.Apellido)</small>
            </fieldset>
        </div>
    </div>
    <div class="row">
        <div class="col-sm-13">
            <fieldset class="form-group">
                <label for="Nombre">Username</label>
                @Html.TextBoxFor(m => m.Usuario.Usuario, new { @class = "form-control", @placeholder = "Username ..." })
                <small class="text-muted">@Html.ValidationMessageFor(m => m.Usuario.Usuario)</small>
                @if (ViewBag.ErrorUsuario)
                {
                    <br /><small style="color:red;">Username already exists</small>
                }

            </fieldset>
        </div>
    </div>
    <div class="row">
        <div class="col-sm-13">
            <fieldset class="form-group">
                <label for="Nombre">Password</label>
                @Html.TextBoxFor(m => m.Usuario.Clave, new { @class = "form-control", @placeholder = "Password ..." })
                <small class="text-muted">@Html.ValidationMessageFor(m => m.Usuario.Clave)</small>
            </fieldset>
        </div>
    </div>
    <div class="row">
        <div class="col-sm-13">
            <fieldset class="form-group">
                <label for="Nombre">Email</label>
                @Html.TextBoxFor(m => m.Usuario.Email, new { @class = "form-control", @placeholder = "Email ..." })
                <small class="text-muted">@Html.ValidationMessageFor(m => m.Usuario.Email)</small>

            </fieldset>
        </div>
    </div>
    <div class="row">
        <div class="col-sm-13">
            <fieldset class="form-group">
                <label for="Nombre">Phone No.</label>
                @Html.TextBoxFor(m => m.Usuario.Telefono, new { @class = "form-control", @placeholder = "Phone No ..." })

            </fieldset>
        </div>
    </div>
    <div class="row">
        <div class="col-sm-13">
            <fieldset class="form-group">
                <label for="Nombre">Roles</label>
                @{
                    List<SelectListItem> ListRoles = new List<SelectListItem>();
                    ListRoles.Add(new SelectListItem() { Value = "0", Text = "Choose Role", Selected = false });

                    var listItems = new SelectList(@ViewBag.ComboRol);
                    foreach (var fila in ViewBag.ComboRol)
                    {
                        if (@fila.Value == @ViewBag.RefIdRoles)
                        { ListRoles.Add(new SelectListItem() { Value = @fila.Value, Text = @fila.Text, Selected = true }); }
                        else
                        { ListRoles.Add(new SelectListItem() { Value = @fila.Value, Text = @fila.Text, Selected = false }); }
                    }
                }
                @Html.DropDownList("CboRoles", ListRoles, new { @class = "form-control", @placeholder = "Roles ..." })
                @if (ViewBag.ErrorRol)
                {
                    <small class="text-muted" style="color:red;">Required</small>
                }
            </fieldset>
        </div>
    </div>
    <div class="row">
        <div class="col-sm-13">
            <fieldset class="form-group">
                <label for="Nombre">Deleted</label>
                @Html.CheckBoxFor(m => m.Usuario.Borrado, new { @class = "form-control" })

            </fieldset>
        </div>
    </div>
    <div class="row">
        <div class="col-sm-13">
            <fieldset class="form-group">
                <label for="Nombre">Special Permits</label>
                @if (ViewBag.ErrorPermiso)
                {
                    <br /><small style="color:red;">Required</small>
                }

            </fieldset>
        </div>
    </div>
    <div class="=row">
        <div class="col-sm-3">
            <fieldset class="form-group">
                <label for="Nombre">BU Permit</label>
                @{
                List<SelectListItem> ListBU = new List<SelectListItem>();
                ListBU.Add(new SelectListItem() { Value = "0", Text = "Choose a BU", Selected = false });

                var listItems1 = new SelectList(@ViewBag.MasterBU);
                foreach (var fila in ViewBag.MasterBU)
                {
                    ListBU.Add(new SelectListItem() { Value = @fila.Value, Text = @fila.Text, Selected = false });
                }
                }
                @Html.DropDownList("CboBU", ListBU, new { @class = "form-control", @placeholder = "Roles ..." })
            </fieldset>
        </div>
        <div class="col-sm-3">
            <fieldset class="form-group">
                <label for="Nombre">SMO Permit</label>
                @{
                List<SelectListItem> ListSMO = new List<SelectListItem>();
                ListSMO.Add(new SelectListItem() { Value = "0", Text = "Choose an SMO", Selected = false });

                var listItems2 = new SelectList(@ViewBag.MasterSMO);
                foreach (var fila in ViewBag.MasterSMO)
                {
                    ListSMO.Add(new SelectListItem() { Value = @fila.Value, Text = @fila.Text, Selected = false });
                }
                }
                @Html.DropDownList("CboSMO", ListSMO, new { @class = "form-control", @placeholder = "Roles ..." })
            </fieldset>
        </div>
        <div class="col-sm-3">
            <fieldset class="form-group">
                <label for="Nombre">OWNER Permit</label>
                @{
                List<SelectListItem> ListOWNER = new List<SelectListItem>();
                ListOWNER.Add(new SelectListItem() { Value = "0", Text = "Choose OWNER", Selected = false });

                var listItems3 = new SelectList(@ViewBag.MasterOW);
                foreach (var fila in ViewBag.MasterOW)
                {
                    ListOWNER.Add(new SelectListItem() { Value = @fila.Value, Text = @fila.Text, Selected = false });
                }
                }
                @Html.DropDownList("CboOWNER", ListOWNER, new { @class = "form-control", @placeholder = "Roles ..." })
            </fieldset>
        </div>
        <div class="col-sm-3">
            <label for="Nombre">Actionn</label><br />
            <input type="button" value="Add Permits" id="Agregar" class="btn btn-info" onclick="AgregaPermisoESP();" />
        </div>
    </div>
    <div class="row">
        <table id="tablaPermisos" width=100% class="table">
            <thead>
                <tr><td style="display: none"><td style="display: none"><td style="display: none"><td width=30%> Permirs BU</td> <td width=30%>Permirs SMO</td> <td width=30%>Permirs OWNER</td> <td width=30%>Delete</td></tr>
                @{
                foreach (LARCA2.Data.DatabaseModels.LARCA20_User_Owner fila in Model.Usuario.LARCA20_User_Owner)
                {
                    if (@fila.Borrado == false)
                    { 
                    <tr>
                        <td style="display: none">@fila.IdBU</td><td style="display: none">@fila.IdOwner</td><td style="display: none">@fila.IdSmo</td><td>@fila.LARCA20_MasterData.DataFin</td><td>@fila.LARCA20_MasterData1.DataFin</td><td>@fila.LARCA20_MasterData2.DataFin</td><td><button id="btn_LESSPermiso" onclick="FuncLESSPermiso(this)" value="Remove" class="btn btn-warning"> Remove</button></td>
                    </tr>
                    }
                }
                }
            </thead>
            <tbody></tbody>
        </table>
    </div>
    <div class="row">
        <div class="pull-right col">
            <input type="submit" value="Save Changes" name="Save" class="btn btn-success" />&nbsp;&nbsp;&nbsp;
            <input type="button" value="Back" id="Volver" class="btn btn-danger" onclick="@("window.location.href='" + @Url.Action("UserBM", "Adm") + "'");" />
        </div>
    </div>
    }
</div>


